<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HuxleyGames — Roborun Robotank Arena | Web3 Game Platform</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@500;700;800&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --hux-bg: #0a0c0e;
      --hux-surface: #12161a;
      --hux-card: #1a1f26;
      --hux-edge: #2a313c;
      --hux-text: #e4e8ec;
      --hux-dim: #7a8494;
      --hux-accent: #06b6d4;
      --hux-tank: #34d399;
      --hux-danger: #f43f5e;
      --hux-warn: #fbbf24;
      --hux-radius: 10px;
      --hux-font: "Syne", sans-serif;
      --hux-mono: "Space Grotesk", sans-serif;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--hux-font);
      background: var(--hux-bg);
      color: var(--hux-text);
      min-height: 100vh;
      background-image:
        radial-gradient(ellipse 80% 50% at 50% 0%, rgba(6, 182, 212, 0.06), transparent),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(52, 211, 153, 0.04), transparent);
    }
    .hux-wrap {
      max-width: 900px;
      margin: 0 auto;
      padding: 1.5rem;
      min-height: 100vh;
    }
    header.hux-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--hux-edge);
      margin-bottom: 1.5rem;
    }
    .hux-logo {
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--hux-accent);
      letter-spacing: 0.04em;
    }
    .hux-tagline {
      font-size: 0.75rem;
      color: var(--hux-dim);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-top: 0.2rem;
    }
    .hux-wallet-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .hux-wallet-addr {
      font-family: var(--hux-mono);
      font-size: 0.8rem;
      color: var(--hux-dim);
      max-width: 180px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .hux-btn {
      font-family: var(--hux-font);
      font-size: 0.85rem;
      font-weight: 700;
      padding: 0.5rem 1rem;
      border: 1px solid var(--hux-accent);
      border-radius: var(--hux-radius);
      background: rgba(6, 182, 212, 0.1);
      color: var(--hux-accent);
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    .hux-btn:hover {
      background: rgba(6, 182, 212, 0.2);
      transform: scale(1.02);
    }
    .hux-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .hux-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.25rem;
      margin-bottom: 1.5rem;
    }
    @media (max-width: 640px) {
      .hux-grid { grid-template-columns: 1fr; }
    }
    .hux-card {
      background: var(--hux-card);
      border: 1px solid var(--hux-edge);
      border-radius: var(--hux-radius);
      padding: 1.25rem;
    }
    .hux-card h2 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--hux-accent);
      margin-bottom: 0.75rem;
      letter-spacing: 0.04em;
    }
    .hux-leaderboard-list {
      list-style: none;
    }
    .hux-leaderboard-list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.4rem 0;
      border-bottom: 1px solid var(--hux-edge);
      font-size: 0.85rem;
    }
    .hux-leaderboard-list li:last-child { border-bottom: none; }
    .hux-rank { color: var(--hux-dim); width: 2rem; }
    .hux-score { color: var(--hux-tank); font-family: var(--hux-mono); }
    .hux-arena-list {
      list-style: none;
    }
    .hux-arena-list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--hux-edge);
      font-size: 0.85rem;
    }
    .hux-arena-list li:last-child { border-bottom: none; }
    .hux-arena-phase {
      font-size: 0.75rem;
      color: var(--hux-tank);
      text-transform: uppercase;
    }
    .hux-arena-bounty { color: var(--hux-warn); font-family: var(--hux-mono); }
    .hux-game-zone {
      background: var(--hux-card);
      border: 1px solid var(--hux-edge);
      border-radius: var(--hux-radius);
      padding: 1.25rem;
      margin-bottom: 1.5rem;
    }
    .hux-game-zone h2 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--hux-accent);
      margin-bottom: 0.75rem;
    }
    #hux-canvas {
      display: block;
      width: 100%;
      height: 320px;
      background: var(--hux-surface);
      border-radius: 8px;
      border: 1px solid var(--hux-edge);
    }
    .hux-game-strip {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.75rem;
      padding: 0.5rem 0;
      font-family: var(--hux-mono);
      font-size: 0.8rem;
    }
    .hux-metric { display: flex; gap: 0.35rem; }
    .hux-metric-name { color: var(--hux-dim); }
    .hux-metric-val { color: var(--hux-tank); }
    .hux-overlay {
      position: absolute;
      inset: 0;
      background: rgba(10, 12, 14, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      padding: 1.5rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
      border-radius: var(--hux-radius);
    }
    .hux-overlay.show { opacity: 1; pointer-events: auto; }
    .hux-overlay h3 { color: var(--hux-accent); font-size: 1.2rem; }
    .hux-overlay p { color: var(--hux-dim); font-size: 0.9rem; text-align: center; }
    .hux-game-container { position: relative; }
    .hux-footer {
      text-align: center;
      font-size: 0.75rem;
      color: var(--hux-dim);
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px solid var(--hux-edge);
    }
    .hux-footer a { color: var(--hux-accent); text-decoration: none; }
    .hux-footer a:hover { text-decoration: underline; }
    .hux-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--hux-edge);
      padding-bottom: 0.5rem;
    }
    .hux-tab {
      font-family: var(--hux-font);
      font-size: 0.85rem;
      font-weight: 600;
      padding: 0.4rem 0.8rem;
      border: 1px solid transparent;
      border-radius: 6px;
      background: transparent;
      color: var(--hux-dim);
      cursor: pointer;
      transition: color 0.2s, background 0.2s;
    }
    .hux-tab:hover { color: var(--hux-text); }
    .hux-tab.active { color: var(--hux-accent); background: rgba(6, 182, 212, 0.1); border-color: var(--hux-edge); }
    .hux-panel { display: none; }
    .hux-panel.active { display: block; }
    .hux-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }
    .hux-stat-box {
      background: var(--hux-surface);
      border: 1px solid var(--hux-edge);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
    }
    .hux-stat-label { font-size: 0.7rem; color: var(--hux-dim); text-transform: uppercase; letter-spacing: 0.08em; }
    .hux-stat-value { font-size: 1.1rem; font-weight: 700; color: var(--hux-tank); font-family: var(--hux-mono); }
    .hux-platform-info {
      font-size: 0.8rem;
      color: var(--hux-dim);
      line-height: 1.6;
      margin-top: 1rem;
    }
    .hux-platform-info code { background: var(--hux-surface); padding: 0.15rem 0.4rem; border-radius: 4px; color: var(--hux-accent); }
    .hux-mono-short { font-family: var(--hux-mono); font-size: 0.75rem; word-break: break-all; }
    .hux-section-title { font-size: 0.9rem; font-weight: 700; color: var(--hux-accent); margin: 1rem 0 0.5rem; }
    .hux-list-small { list-style: none; font-size: 0.8rem; }
    .hux-list-small li { padding: 0.25rem 0; border-bottom: 1px solid var(--hux-edge); }
    .hux-list-small li:last-child { border-bottom: none; }
    .hux-badge { display: inline-block; padding: 0.15rem 0.5rem; border-radius: 4px; font-size: 0.7rem; background: rgba(52, 211, 153, 0.2); color: var(--hux-tank); }
    .hux-badge.warn { background: rgba(251, 191, 36, 0.2); color: var(--hux-warn); }
    .hux-badge.danger { background: rgba(244, 63, 94, 0.2); color: var(--hux-danger); }
    @media (max-width: 480px) {
      .hux-logo { font-size: 1.4rem; }
      .hux-wrap { padding: 1rem; }
      .hux-stats-grid { grid-template-columns: 1fr 1fr; }
      .hux-wallet-addr { max-width: 100px; }
    }
    .hux-code-block {
      background: var(--hux-surface);
      border: 1px solid var(--hux-edge);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      font-family: var(--hux-mono);
      font-size: 0.75rem;
      color: var(--hux-dim);
      overflow-x: auto;
      margin: 0.5rem 0;
    }
    .hux-note {
      font-size: 0.8rem;
      color: var(--hux-dim);
      margin-top: 0.5rem;
      padding-left: 0.75rem;
      border-left: 3px solid var(--hux-accent);
    }
    .hux-errors-list { list-style: none; font-size: 0.78rem; color: var(--hux-dim); }
    .hux-errors-list li { padding: 0.2rem 0; }
    .hux-errors-list code { color: var(--hux-warn); }
    .hux-btn:focus-visible { outline: 2px solid var(--hux-accent); outline-offset: 2px; }
    .hux-tab:focus-visible { outline: 2px solid var(--hux-accent); outline-offset: 2px; }
    @media (prefers-reduced-motion: reduce) {
      .hux-btn:hover { transform: none; }
      .hux-overlay { transition: none; }
    }
    @media print {
      .hux-wrap { max-width: none; }
      .hux-btn, .hux-tabs, #hux-canvas { display: none !important; }
      .hux-card { break-inside: avoid; }
    }
  </style>
</head>
<body>
  <div class="hux-wrap">
    <header class="hux-header">
      <div>
        <div class="hux-logo">HuxleyGames</div>
        <div class="hux-tagline">Roborun · Robotank Arena · Web3</div>
      </div>
      <div class="hux-wallet-row">
        <span class="hux-wallet-addr" id="hux-wallet">Not connected</span>
        <button type="button" class="hux-btn" id="hux-connect-btn">Connect</button>
      </div>
    </header>

    <div class="hux-stats-grid" id="hux-stats-row">
      <div class="hux-stat-box"><div class="hux-stat-label">Global tick</div><div class="hux-stat-value" id="hux-stat-tick">0</div></div>
      <div class="hux-stat-box"><div class="hux-stat-label">Arenas</div><div class="hux-stat-value" id="hux-stat-arenas">0</div></div>
      <div class="hux-stat-box"><div class="hux-stat-label">Bounties paid</div><div class="hux-stat-value" id="hux-stat-bounties">0</div></div>
      <div class="hux-stat-box"><div class="hux-stat-label">Platoon size</div><div class="hux-stat-value" id="hux-stat-platoon">28</div></div>
    </div>

    <div class="hux-tabs">
      <button type="button" class="hux-tab active" data-panel="play">Play</button>
      <button type="button" class="hux-tab" data-panel="platform">Platform</button>
    </div>

    <div id="hux-panel-play" class="hux-panel active">
    <div class="hux-grid">
      <div class="hux-card">
        <h2>Leaderboard</h2>
        <ul class="hux-leaderboard-list" id="hux-leaderboard"></ul>
      </div>
      <div class="hux-card">
        <h2>Arenas</h2>
        <ul class="hux-arena-list" id="hux-arenas"></ul>
      </div>
    </div>

    <div class="hux-game-zone">
      <h2>Arena Run</h2>
      <div class="hux-game-container">
        <canvas id="hux-canvas" width="868" height="320"></canvas>
        <div id="hux-start-overlay" class="hux-overlay show">
          <h3>Ready to run</h3>
          <p>AI Tank Runner. Press Space or tap to jump. Reach checkpoints to recharge. Avoid barriers.</p>
          <button type="button" class="hux-btn" id="hux-start-btn">Start Run</button>
        </div>
        <div id="hux-end-overlay" class="hux-overlay">
          <h3 id="hux-end-title">Run over</h3>
          <p id="hux-end-msg">Distance and score below.</p>
          <button type="button" class="hux-btn" id="hux-restart-btn">Run Again</button>
        </div>
      </div>
      <div class="hux-game-strip">
        <div class="hux-metric">
          <span class="hux-metric-name">Distance</span>
          <span class="hux-metric-val" id="hux-distance">0</span>
        </div>
        <div class="hux-metric">
          <span class="hux-metric-name">Battery</span>
          <span class="hux-metric-val" id="hux-battery">100</span>%
        </div>
        <div class="hux-metric">
          <span class="hux-metric-name">Checkpoints</span>
          <span class="hux-metric-val" id="hux-cp">0</span>
        </div>
      </div>
    </div>
    </div>

    <div id="hux-panel-platform" class="hux-panel">
      <div class="hux-card">
        <h2>Platform config</h2>
        <p class="hux-platform-info">
          Roborun-Robotank-Arena-AI-Tank-Runner engine. Addresses and hex are unique to this platform (not reused from other contracts).
        </p>
        <div class="hux-section-title">Addresses</div>
        <ul class="hux-list-small">
          <li><span class="hux-mono-short">Operator: 0xE0b4C6d8F2a4B6c8D0e2F4a6B8c0D2e4F6a8B4c6</span></li>
          <li><span class="hux-mono-short">Vault: 0xC8f2A4b6D0e2F4a6B8c0D2e4F6a8B0c2D4e6F8a2</span></li>
          <li><span class="hux-mono-short">Treasury: 0xB7e1F3a5C9d2E4f6A8b0C2d4E6f8A0b2C4d6E8f1</span></li>
          <li><span class="hux-mono-short">Reward pool: 0xD9a3B5c7E1f3A5b7C9d1E3f5A7b9C1d3E5f7A9b3</span></li>
          <li><span class="hux-mono-short">Oracle: 0xF1c5D7e9A3b5C7d9E1f3A5b7C9d1E3f5A7b9C5d7</span></li>
        </ul>
        <div class="hux-section-title">Constants</div>
        <ul class="hux-list-small">
          <li>MAX_PLATOON_SIZE: 28 · ARENA_COOLDOWN_TICKS: 81 · TICK_MODULUS: 29</li>
          <li>VAULT_SHARE_BPS: 80 · CONTROL_SHARE_BPS: 20 · BOUNTY_BASE_UNITS: 3072</li>
          <li>DAMAGE_PER_TURRET_FIRE: 15 · SCORE_PER_CHECKPOINT: 50 · SCORE_PER_KILL: 100</li>
          <li>PHASE_DURATION_BLOCKS: 447 · MAX_PHASE_INDEX: 7</li>
          <li>MAX_ACTIVE_ARENAS: 64 · MAX_MATCHES_PER_ARENA: 256</li>
          <li>BATTERY_DRAIN_PER_TICK: 2 · BATTERY_RECHARGE_AT_CHECKPOINT: 30</li>
          <li>DEFAULT_STARTING_BATTERY: 100 · MIN_BATTERY_TO_FIRE: 12</li>
          <li>LEADERBOARD_TOP_N: 100 · SESSION_TIMEOUT_SECONDS: 3600</li>
        </ul>
        <div class="hux-section-title">Salts (hex)</div>
        <ul class="hux-list-small">
          <li class="hux-mono-short">ARENA_DOMAIN_SALT: 0x1a9e7c3b5d0f2e4a6c8b0d2f4a6e8c0b2d4f6a8e0</li>
          <li class="hux-mono-short">PLATFORM_VERSION_HASH: 0x3f8b2d4e6a0c2e4f6b8d0a2c4e6f8b0d2a4c6e8f0</li>
          <li class="hux-mono-short">CHASSIS_MINT_SALT: 0x5c2e8a1d4f7b0e3a6c9d2f5a8b1e4c7d0a3f6b9e2</li>
          <li class="hux-mono-short">MATCHMAKING_SEED: 0x7e4a0c2d6f8b1e3a5c7d9f0b2d4e6a8c0e2f4b6d8</li>
        </ul>
        <div class="hux-section-title">API methods (roborun_robotank_arena_platform.py)</div>
        <p class="hux-platform-info">Single-file engine. Use handle_api_request(platform, method, params) for JSON API. Supported methods:</p>
        <ul class="hux-list-small">
          <li>config · launch_arena · get_arena · advance_phase · assign_slot · fire_turret</li>
          <li>seed_bounty · claim_bounty · terminate_arena · flip_pause · get_platoon_slot · get_chassis_stats</li>
          <li>create_match · get_match · add_match_score · finish_match · get_or_create_player · get_player</li>
          <li>get_leaderboard · tick · record_checkpoint · create_session · get_session</li>
          <li>get_arena_summary · get_match_summary · health · readiness · get_constants</li>
        </ul>
        <div class="hux-section-title">How to play</div>
        <ul class="hux-list-small">
          <li>Press <strong>Start Run</strong> to begin the AI Tank Runner. Your tank auto-runs; press <strong>Space</strong> or <strong>Up</strong> to jump over barriers.</li>
          <li>Battery drains over time. Pass through green <strong>checkpoints</strong> (CP) to recharge. Avoid red obstacles or the run ends.</li>
          <li>Leaderboard and Arenas panels show platform state. Connect a wallet (demo: button toggles a placeholder address).</li>
          <li>Platform tab shows operator, vault, treasury, reward pool, oracle addresses and constants used by the Python engine. All addresses and hex values are unique to this platform and not reused from Robotank.sol, BacklineLedger, Rockaf, or other contracts.</li>
        </ul>
        <div class="hux-section-title">Platform exceptions (engine)</div>
        <p class="hux-note">Unique error names; not Tank*, Ledger_*, RigCue_*.</p>
        <ul class="hux-errors-list">
          <li><code>ArenaEngineNotOperator</code> — Caller is not the operator cortex.</li>
          <li><code>ArenaEngineArenaNotFound</code> — Arena id does not exist.</li>
          <li><code>ArenaEngineArenaPaused</code> — Arena is paused.</li>
          <li><code>ArenaEnginePhaseLocked</code> — Phase transition not allowed.</li>
          <li><code>ArenaEnginePlatoonFull</code> — Platoon slot capacity reached.</li>
          <li><code>ArenaEngineBatteryDepleted</code> — Chassis battery too low.</li>
          <li><code>ArenaEngineCooldownActive</code> — Turret or action on cooldown.</li>
          <li><code>ArenaEngineChassisNotFound</code> — Chassis or player not registered.</li>
          <li><code>ArenaEngineMatchNotFound</code> / <code>ArenaEngineMatchNotActive</code> — Match state invalid.</li>
          <li><code>ArenaEngineInvalidAmount</code> / <code>ArenaEngineZeroDisallowed</code> — Value or address invalid.</li>
        </ul>
        <div class="hux-section-title">Example request (handle_api_request)</div>
        <div class="hux-code-block">handle_api_request(platform, "launch_arena", { "caller": "0xE0b4C6d8F2a4B6c8D0e2F4a6B8c0D2e4F6a8B4c6" })</div>
        <div class="hux-section-title">Example response (launch_arena)</div>
        <div class="hux-code-block">{ "arena_id": 1, "global_tick": 1 }</div>
        <div class="hux-section-title">Example response (get_leaderboard)</div>
        <div class="hux-code-block">{ "entries": [ { "rank": 1, "player_id": "tank_alpha", "wallet_ref": "0xB7e1...E8f1", "total_score": 4520, "wins": 12, "matches": 28 } ] }</div>
        <div class="hux-section-title">Example response (health)</div>
        <div class="hux-code-block">{ "ok": true, "config_errors": [], "arena_counter": 0, "global_tick": 0, "paused": false }</div>
        <div class="hux-section-title">Phase labels (arena)</div>
        <ul class="hux-list-small">
          <li>0: Idle · 1: Warmup · 2: Engaged · 3: Peak · 4: Closure · 5: Settle · 6: Terminal</li>
        </ul>
        <div class="hux-section-title">Address and hex uniqueness</div>
        <p class="hux-platform-info">The five addresses (Operator, Vault, Treasury, Reward pool, Oracle) and four hex salts above are used only in this platform and in roborun_robotank_arena_platform.py. They are not reused from Robotank.sol, BacklineLedger, Rockaf, RigCue, HermesAI, EwAI, ThornGate, FlintLock, or any other contract or code generation. confirm_addresses_unique() and confirm_hex_salts_unique() in the Python engine verify this.</p>
        <div class="hux-section-title">Build</div>
        <p class="hux-platform-info">HuxleyGames · Roborun-Robotank-Arena-AI-Tank-Runner · Web3 online game platform · Single-file Python engine: roborun_robotank_arena_platform.py (1970–2500 LOC). Addresses and hex confirmed unique; no reuse from other code generations.</p>
        <div class="hux-section-title">Related</div>
        <ul class="hux-list-small">
          <li>Robotank.sol (Solidity) — on-chain arena, platoon, bounty; different addresses.</li>
          <li>roborun/index.html — Roborun tank runner game (Orbitron theme).</li>
          <li>BacklineLedger, Rockaf, RigCue — other contracts; no address/hex overlap with this platform.</li>
          <li>Python: create_platform(), handle_api_request(), run_simulation(), run_simulation_v2(), health_check().</li>
          <li>Addresses and hex in this UI match roborun_robotank_arena_platform.py; confirm_addresses_unique() / confirm_hex_salts_unique().</li>
        </ul>
      </div>
    </div>

    <p class="hux-footer">
      Roborun-Robotank-Arena · Platform engine: <code>roborun_robotank_arena_platform.py</code> ·
      <a href="../roborun/">Roborun</a> · Addresses and hex in this UI match the Python engine and are unique (not reused from other contracts).
    </p>
  </div>

  <script>
    (function () {
      const canvas = document.getElementById("hux-canvas");
      const ctx = canvas.getContext("2d");
      const startOverlay = document.getElementById("hux-start-overlay");
      const endOverlay = document.getElementById("hux-end-overlay");
      const startBtn = document.getElementById("hux-start-btn");
      const restartBtn = document.getElementById("hux-restart-btn");
      const distanceEl = document.getElementById("hux-distance");
      const batteryEl = document.getElementById("hux-battery");
      const cpEl = document.getElementById("hux-cp");
      const endTitle = document.getElementById("hux-end-title");
      const endMsg = document.getElementById("hux-end-msg");
      const walletEl = document.getElementById("hux-wallet");
      const connectBtn = document.getElementById("hux-connect-btn");
      const leaderboardEl = document.getElementById("hux-leaderboard");
      const arenasEl = document.getElementById("hux-arenas");

      const W = canvas.width;
      const H = canvas.height;
      const GROUND_Y = H - 52;
      const TANK_W = 42;
      const TANK_H = 26;
      const JUMP_VY = -13;
      const GRAVITY = 0.6;
      const SCROLL = 5.5;
      const BATTERY_DRAIN = 0.06;
      const CP_BATTERY = 28;
      const OB_W = 30;
      const OB_H = 40;
      const OB_GAP_MIN = 200;
      const OB_GAP_MAX = 350;
      const CP_GAP = 550;

      let running = false;
      let tankX = 80;
      let tankY = GROUND_Y;
      let tankVy = 0;
      let onGround = true;
      let distance = 0;
      let battery = 100;
      let checkpoints = 0;
      let obstacles = [];
      let checkpointList = [];
      let nextObAt = OB_GAP_MIN;
      let nextCPAt = CP_GAP;
      let lastT = 0;
      let animId = 0;

      function resizeCanvas() {
        const container = canvas.parentElement;
        const r = Math.min(container.clientWidth / W, 1);
        canvas.style.width = W * r + "px";
        canvas.style.height = H * r + "px";
      }
